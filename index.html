<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯çˆ±è¡¨æƒ…è·‘é©¬ç¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF85A2', // æŸ”å’Œç²‰è‰²ä½œä¸ºä¸»è‰²è°ƒ
                        secondary: '#97D2EC', // æµ…è“è‰²ä½œä¸ºè¾…åŠ©è‰²
                        neutral: '#FAFAFA', // ç±³ç™½è‰²èƒŒæ™¯
                        purple: {
                            light: '#A97CF8',
                            DEFAULT: '#8B5CF6',
                            dark: '#7C3AED'
                        }
                    },
                    fontFamily: {
                        cute: ['Comic Sans MS', 'Chalkboard SE', 'sans-serif'], // å¯çˆ±é£æ ¼å­—ä½“
                    },
                },
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .animate-swing-once {
                animation: swing 1.5s ease-in-out forwards;
            }
            .marquee-container {
                overflow: hidden;
                white-space: nowrap;
            }
            .marquee-content {
                display: inline-block;
                animation: marquee 20s linear infinite;
            }
            .marquee-content:hover {
                animation-play-state: paused;
            }
            @keyframes marquee {
                0% {
                    transform: translateX(0);
                }
                100% {
                    transform: translateX(-50%);
                }
            }
            .emoji-card {
                transition: transform 0.3s ease;
            }
            .emoji-card:hover {
                transform: scale(1.1) rotate(5deg);
            }
            .fade-in {
                animation: fadeIn 0.5s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .emoji-part {
                transition: transform 0.2s ease;
            }
            .emoji-part:hover {
                transform: scale(1.1);
                cursor: pointer;
            }
            .emoji-part.selected {
                border: 2px solid #FF85A2;
                border-radius: 50%;
                background-color: rgba(255, 133, 162, 0.1);
            }
            .modal {
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            .modal.active {
                opacity: 1;
                visibility: visible;
            }
            .modal-content {
                transform: translateY(-20px);
                transition: transform 0.3s ease;
            }
            .modal.active .modal-content {
                transform: translateY(0);
            }
            
            /* BlurFade åŠ¨ç”»æ•ˆæœ */
            .blur-fade {
                opacity: 0;
                filter: blur(12px);
                transform: translateY(20px);
                transition: opacity 0.8s ease-out, filter 0.8s ease-out, transform 0.8s ease-out;
            }
            .blur-fade.visible {
                opacity: 1;
                filter: blur(0);
                transform: translateY(0);
            }


            /* è¡¨æƒ…åº“å±•ç¤ºæ¨¡å—åŠ¨ç”» */
            .emoji-display {
                height: 400px; 
                min-width: 300px; 
                perspective: 1000px;
            }
            .emoji-item {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                transition: all 0.4s ease-in-out;
                opacity: 0;
                transform: scale(0.9) rotateY(0deg);
                z-index: 10;
            }
            .emoji-item.active {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
                z-index: 40;
                animation: float 3s ease-in-out infinite;
            }
            .emoji-item.inactive {
                opacity: 0.7;
                transform: scale(0.95) rotateY(var(--rotate-y, 0deg));
                z-index: 20;
            }
            @keyframes float {
                0%, 100% { transform: scale(1) rotateY(0deg) translateY(0); }
                50% { transform: scale(1) rotateY(0deg) translateY(-5px); }
            }
            .word-animation {
                display: inline-block;
                opacity: 0;
                filter: blur(10px);
                transform: translateY(5px);
                transition: all 0.2s ease-in-out;
            }
            .button-icon {
                transition: transform 0.3s ease;
            }
            .control-button:hover .button-icon {
                transform: rotate(12deg);
            }
            .control-button:hover .button-icon.right {
                transform: rotate(-12deg);
            }
            #confetti-canvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }
            .success-message {
                animation: fadeInOut 2.5s ease-in-out forwards;
            }
            @keyframes swing {
                0% { transform: scale(1); opacity: 0.8; }
                20% { transform: scale(1.1) rotate(-3deg); opacity: 1; }
                60% { transform: scale(1.1) rotate(3deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(20px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
            .purple-gradient-bg {
                background: linear-gradient(135deg, #A97CF8 0%, #8B5CF6 50%, #7C3AED 100%);
            }
            .purple-overlay {
                background: rgba(139, 92, 246, 0.15);
            }

        }
    </style>
</head>
<body class="bg-neutral font-cute min-h-screen">
    <!-- ç²’å­æ•ˆæœç”»å¸ƒ -->
    <canvas id="confetti-canvas"></canvas>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <header class="text-center py-8 bg-gradient-to-b from-primary/20 to-transparent">
        <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-2 blur-fade" data-delay="0.25">è¡¨æƒ…åˆ›æ„å®éªŒå®¤</h1>
        <p class="text-gray-600 max-w-md mx-auto blur-fade" data-delay="0.5">ç”¨ç®€å•å…ƒç´ æ‹¼å‡ºä¸“å±è¡¨æƒ… ğŸ¨</p>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- è·‘é©¬ç¯ç»„ä»¶ -->
        <section class="mb-16">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-primary flex items-center">
                    <i class="fa fa-sliders mr-2"></i> è¡¨æƒ…è·‘é©¬ç¯
                </h2>
                <div class="flex space-x-2">
                    <button id="speed-down" class="bg-primary/10 hover:bg-primary/20 text-primary px-3 py-1 rounded-full transition-all">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button id="speed-up" class="bg-primary/10 hover:bg-primary/20 text-primary px-3 py-1 rounded-full transition-all">
                        <i class="fa fa-plus"></i>
                    </button>
                    <button id="reverse" class="bg-primary/10 hover:bg-primary/20 text-primary px-3 py-1 rounded-full transition-all">
                        <i class="fa fa-refresh"></i>
                    </button>
                </div>
            </div>
            
            <!-- è·‘é©¬ç¯å®¹å™¨ -->
            <div class="marquee-container bg-white rounded-xl shadow-lg p-4 overflow-hidden relative">
                <!-- è£…é¥°å…ƒç´  -->
                <div class="absolute top-2 left-2 text-secondary opacity-50">
                    <i class="fa fa-star"></i>
                </div>
                <div class="absolute bottom-2 right-2 text-secondary opacity-50">
                    <i class="fa fa-heart"></i>
                </div>
                
                <!-- è·‘é©¬ç¯å†…å®¹ -->
                <div id="marquee" class="marquee-content">
                    <div id="emoji-container" class="inline-flex space-x-4"></div>
                </div>
            </div>
        </section>

        <!-- è¡¨æƒ…åº“å±•ç¤ºæ¨¡å— -->
        <section class="mb-16 bg-white rounded-xl shadow-lg p-6 emoji-gallery">
            <h2 class="text-xl font-bold text-primary mb-6 flex items-center">
                <i class="fa fa-th mr-2"></i> è¡¨æƒ…åº“ç²¾é€‰
            </h2>
            
            <div class="max-w-4xl mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <!-- è¡¨æƒ…å±•ç¤ºåŒº -->
                    <div class="emoji-display relative h-80 w-full rounded-3xl overflow-hidden shadow-lg min-h-[400px] min-w-full md:min-w-[300px]">
                        <div id="emoji-items-container" class="relative h-full w-full">
                            <!-- è¡¨æƒ…é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- ä¿¡æ¯å’Œæ§åˆ¶åŒº -->
                    <div>
                        <div id="emoji-info">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2" id="emoji-name">å¼€å¿ƒç¬‘è„¸</h3>
                            <p class="text-sm text-gray-500 mb-6" id="emoji-category">åŸºç¡€è¡¨æƒ… Â· æ­£é¢æƒ…ç»ª</p>
                            <p class="text-lg text-gray-600 mb-8" id="emoji-description">
                                è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å¼€å¿ƒç¬‘è„¸è¡¨æƒ…ï¼Œåœ†åœ†çš„è„¸è›‹å¸¦ç€æ¸©æš–çš„ç¬‘å®¹ï¼Œé€‚åˆè¡¨è¾¾å–œæ‚¦å’Œå‹å¥½çš„æƒ…æ„Ÿã€‚
                            </p>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰é’® -->
                        <div class="flex space-x-4">
                            <button id="prev-emoji" class="control-button flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                                <i class="fa fa-arrow-left button-icon text-gray-700"></i>
                            </button>
                            <button id="next-emoji" class="control-button flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                                <i class="fa fa-arrow-right button-icon right text-gray-700"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- éšæœºè¡¨æƒ…ç”Ÿæˆå™¨ -->
        <section id="random-emoji-generator" class="mb-16 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
                <i class="fa fa-random mr-2"></i> éšæœºè¡¨æƒ…ç”Ÿæˆå™¨
            </h2>
            <div class="text-center py-8">
                <div id="random-emoji-display" class="mx-auto w-80 h-80 rounded-lg shadow-lg overflow-hidden purple-overlay">
                    <div id="loading-placeholder" class="purple-gradient-bg w-full h-full flex items-center justify-center">
                        <i class="fa fa-magic text-white text-3xl"></i>
                    </div>
                </div>
                <button id="generate-random-emoji" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-full transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <i class="fa fa-magic mr-2"></i> ç”Ÿæˆéšæœºè¡¨æƒ…
                </button>
            </div>
        </section>
        
        <!-- è¡¨æƒ…åˆ¶ä½œå™¨ -->
        <section id="emoji-maker" class="mb-16">
            <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
                <i class="fa fa-paint-brush mr-2"></i> è¡¨æƒ…åˆ¶ä½œå™¨
            </h2>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <p class="text-gray-600 mb-6">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ¶ä½œä½ çš„ä¸“å±è¡¨æƒ…ï¼</p>
                <button id="open-emoji-maker" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-full transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <i class="fa fa-smile-o mr-2"></i> å¼€å§‹åˆ¶ä½œ
                </button>
            </div>
        </section>
    </main>

    <footer class="bg-primary/10 py-6 text-center text-gray-600">
        <p>è¡¨æƒ…åˆ›æ„å®éªŒå®¤ &copy; 2025</p>
    </footer>

    <!-- è¡¨æƒ…åˆ¶ä½œå™¨å¼¹çª— -->
    <div id="emoji-maker-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/50">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-primary">è¡¨æƒ…åˆ¶ä½œå™¨</h3>
                <button id="close-emoji-maker" class="text-gray-500 hover:text-primary transition-colors">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6">
                <!-- è¡¨æƒ…é¢„è§ˆ -->
                <div class="mb-8 text-center">
                    <h4 class="text-lg font-medium text-gray-700 mb-4">è¡¨æƒ…é¢„è§ˆ</h4>
                    <div id="emoji-preview" class="relative w-64 h-64 mx-auto bg-yellow-100 rounded-full overflow-hidden">
                        <img id="hair-img" src="images/hairstyle1.jpg" alt="å‘å‹" class="absolute inset-0 w-full h-full object-cover" style="z-index: 10;" />
                        <img id="eyes-img" src="images/face1.png" alt="çœ¼ç›" class="absolute inset-0 w-full h-full object-contain transition-transform duration-300" style="z-index: 20;" />
                    </div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-6 text-base">
                    <!-- å·¦ä¾§ï¼šæ”¾å¤§/ç¼©å° -->
                    <div class="flex flex-col items-center gap-3">
                        <button id="zoom-in-btn" class="flex items-center gap-2 px-4 py-2 bg-pink-500 text-white rounded-md shadow-sm hover:bg-pink-600 transition-colors">
                            <i class="fa fa-search-plus"></i> æ”¾å¤§çœ¼ç›
                        </button>
                        <button id="zoom-out-btn" class="flex items-center gap-2 px-4 py-2 bg-sky-500 text-white rounded-md shadow-sm hover:bg-sky-600 transition-colors">
                            <i class="fa fa-search-minus"></i> ç¼©å°çœ¼ç›
                        </button>
                    </div>

                    <!-- ä¸­é—´ï¼šæ–¹å‘æ§åˆ¶ -->
                    <div class="flex flex-col items-center gap-2">
                        <button id="move-up-btn" class="w-24 px-2 py-2 bg-gray-200 text-gray-800 rounded-md shadow-sm hover:bg-gray-300 transition-colors">
                            <i class="fa fa-arrow-up"></i> ä¸Šç§»
                        </button>
                        <div class="flex gap-2">
                            <button id="move-left-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md shadow-sm hover:bg-gray-300 transition-colors">
                                <i class="fa fa-arrow-left"></i> å·¦ç§»
                            </button>
                            <button id="move-right-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md shadow-sm hover:bg-gray-300 transition-colors">
                                <i class="fa fa-arrow-right"></i> å³ç§»
                            </button>
                        </div>
                        <button id="move-down-btn" class="w-24 px-2 py-2 bg-gray-200 text-gray-800 rounded-md shadow-sm hover:bg-gray-300 transition-colors">
                            <i class="fa fa-arrow-down"></i> ä¸‹ç§»
                        </button>
                    </div>

                    <!-- å³ä¾§ï¼šé‡ç½®/å®Œæˆ -->
                    <div class="flex flex-col items-center gap-3">
                        <button id="complete-btn" class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-md shadow-sm hover:bg-green-600 transition-colors">
                            <i class="fa fa-check"></i> å®Œæˆ
                        </button>
                        <button id="reset-btn" class="flex items-center gap-2 px-4 py-2 bg-yellow-400 text-white rounded-md shadow-sm hover:bg-yellow-500 transition-colors">
                            <i class="fa fa-undo"></i> é‡ç½®
                        </button>
                    </div>
                </div>

                <!-- æˆåŠŸæ¶ˆæ¯ -->
                <div id="success-message" class="success-message absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg font-bold text-xl z-20 hidden">
                    ğŸ‰ è¡¨æƒ…åˆ¶ä½œå®Œæˆï¼Œå¤ªæ£’å•¦ï¼
                </div>

                <!-- å…ƒç´ é€‰æ‹©åŒºåŸŸ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <!-- å‘å‹é€‰æ‹© -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 mb-3">é€‰æ‹©å‘å‹</h4>
                        <div id="hair-options" class="flex flex-wrap gap-3"></div>
                    </div>

                    <!-- çœ¼ç›é€‰æ‹© -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 mb-3">é€‰æ‹©çœ¼ç›</h4>
                        <div id="eyes-options" class="flex flex-wrap gap-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript æ§åˆ¶é€»è¾‘ -->
    <script>
        // è¡¨æƒ…æ•°æ®
        const emojis = [
            { image: 'images/marquee1.jpg', alt: 'æ„¤æ€’è¡¨æƒ…', title: 'æ„¤æ€’è„¸', bgClass: 'bg-primary/10' },
            { image: 'images/marquee2.jpg', alt: 'æƒŠå–œè¡¨æƒ…', title: 'æƒŠå–œè„¸', bgClass: 'bg-secondary/10' },
            { image: 'images/marquee3.jpg', alt: 'å‘ç«è¡¨æƒ…', title: 'å‘ç«è„¸', bgClass: 'bg-primary/10' },
            { image: 'images/marquee4.jpg', alt: 'æ— åŠ©è¡¨æƒ…', title: 'æ— åŠ©è„¸', bgClass: 'bg-secondary/10' },
            { image: 'images/marquee5.jpg', alt: 'å®³ç¾è¡¨æƒ…', title: 'å®³ç¾è„¸', bgClass: 'bg-primary/10' },
            { image: 'images/marquee6.jpg', alt: 'éƒé—·è¡¨æƒ…', title: 'éƒé—·è„¸', bgClass: 'bg-secondary/10' },
            { image: 'images/marquee7.jpg', alt: 'ç–‘æƒ‘è¡¨æƒ…', title: 'ç–‘æƒ‘è„¸', bgClass: 'bg-primary/10' },
            { image: 'images/marquee8.jpg', alt: 'å¤§å“­è¡¨æƒ…', title: 'å¤§å“­è„¸', bgClass: 'bg-secondary/10' }
        ];

        // è¡¨æƒ…åº“æ•°æ®
        const emojiGallery = [
            {
                src: 'images/card1.jpg',
                name: 'å´©æºƒå°äººå›¾é‰´',
                category: 'æƒ…ç»ªè¡¨è¾¾ãƒ»å´©æºƒå‘',
                description: 'ä»¥æç®€çº¿æ¡å‹¾å‹’çš„å°äººå½¢è±¡ï¼Œç²¾å‡†æ•æ‰æˆå¹´äººã€Œä½“é¢å´©å¡Œã€çš„åƒä¸‡ç§ç¬é—´ï¼Œæ˜¯å‹åŠ›å®£æ³„ä¸æƒ…ç»ªå…±é¸£çš„å…·è±¡åŒ–è¡¨è¾¾ã€‚'
            },
            {
                src: 'images/card2.jpg',
                name: 'äº”å®˜æ›¿æ¢è¡¨æƒ…é›†',
                category: 'åˆ›æ„è¡¨æƒ…ãƒ»äº”å®˜é‡æ„',
                description: 'ä»¥è¶£å‘³åŒ–äº”å®˜é‡æ„ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡çˆ±å¿ƒã€é—ªç”µã€ç¬¦å·åŒ–å›¾æ¡ˆç­‰å¤¸å¼ æ›¿æ¢ï¼Œå°†ã€Œè‰²ã€è§¦ç”µã€è´¢è¿·ã€ç­‰æƒ…ç»ªç‰¹è´¨å…·è±¡ä¸ºè¡¨æƒ…ç¬¦å·ï¼Œå±•ç°è„‘æ´å¤§å¼€çš„è¡¨æƒ…è®¾è®¡é€»è¾‘ã€‚'
            },
            {
                src: 'images/card3.jpg',
                name: 'é¢éƒ¨å¤¸å¼ è¡¨æƒ…ç¬¦å·å›¾é‰´',
                category: 'åˆ›æ„è¡¨æƒ…ãƒ»ç¬¦å·ä½“ç³»',
                description: 'é›†åˆæ•°åç§ä»¥æç®€çº¿æ¡æ„å»ºçš„å¤¸å¼ é¢éƒ¨ç¬¦å·ï¼Œé€šè¿‡å˜å½¢äº”å®˜ã€ç¬¦å·åŒ–å›¾æ¡ˆæ¼”ç»å¤šå…ƒæƒ…ç»ªï¼Œæ„å»ºè¶£å‘³åŒ–è¡¨æƒ…ç¬¦å·ä½“ç³»ã€‚'
            },
            {
                src: 'images/card4.jpg',
                name: 'æƒ…ç»ªå¼ºåŒ–ç¬¦å·å›¾é‰´',
                category: 'åˆ›æ„è¡¨æƒ…ãƒ»å…ƒç´ è®¾è®¡æ³•',
                description: 'é€šè¿‡çº¿æ¡ã€ç¬¦å·ï¼ˆæ±—ç ã€æ–œçº¿ã€æ˜Ÿå…‰ç­‰ï¼‰çš„æ·»åŠ æˆ–æ›¿æ¢ï¼Œå°†æƒŠè®¶ã€ç”Ÿæ°”ç­‰æƒ…ç»ªå…·è±¡åŒ–ï¼Œå¦‚ç”¨ç«æ¯›å¼ºåŒ–æƒŠå‘€ã€æ±—çº¿æ¸²æŸ“å´©æºƒï¼Œè§£æè¡¨æƒ…æƒ…ç»ªå¼ºåŒ–çš„è®¾è®¡é€»è¾‘ã€‚'
            },
            {
                src: 'images/card5.jpg',
                name: 'å¤–éƒ¨ç¬¦å·åœºæ™¯åŒ–è¡¨æƒ…å›¾é‰´',
                category: 'åˆ›æ„è¡¨æƒ…ãƒ»ç¬¦å·èµ‹èƒ½æ³•',
                description: 'å€ŸåŠ©é—®å·ã€æ˜Ÿå…‰ã€æ°”æ³¡ç­‰å¤–éƒ¨ç¬¦å·ï¼Œä¸ºç–‘é—®ã€é—ªå…‰ã€èŠ±ç—´ç­‰æƒ…ç»ªæ¤å…¥åœºæ™¯è®°å¿†ç‚¹ï¼Œå¦‚æƒŠå¹å·æ”¾å¤§éœ‡æƒŠå¼ åŠ›ï¼Œçˆ±å¿ƒå¼ºåŒ–èŠ±ç—´æ°›å›´ï¼Œè¯ é‡Šè¡¨æƒ…åœºæ™¯åŒ–çš„è®¾è®¡è·¯å¾„ã€‚'
            },
            {
                src: 'images/card6.jpg',
                name: 'è‚¤è‰²å˜åŒ–æƒ…ç»ªå›¾é‰´',
                category: 'åˆ›æ„è¡¨æƒ…ãƒ»è‰²å½©è¡¨è¾¾',
                description: 'åˆ©ç”¨æš—é¢ã€è‚¤è‰²åŠçº¢æ¶¦åŒºåŸŸçš„å˜åŒ–ï¼Œå¦‚è…¹é»‘çš„å±€éƒ¨æš—æ²‰ã€å®³ç¾çš„è„¸é¢Šç»¯çº¢ã€å´©æºƒçš„æ•´ä½“ç°è°ƒï¼Œç›´è§‚å¼ºåŒ–æƒ…ç»ªçš„è§†è§‰ä¼ è¾¾ã€‚'
            },
            {
                src: 'images/card7.jpg',
                name: 'å–µæ˜Ÿäººå­—æ¯å›¾é‰´',
                category: 'åˆ›æ„è®¾è®¡ãƒ»èŒç³»å­—æ¯',
                description: 'è®©çŒ«å’ªä»¥èº«ä½“å§¿æ€æ¨¡æ‹Ÿç¬¦å·è½®å»“ï¼Œå€Ÿæ–‘æ–“æ¯›è‰²ä¸è½¯èŒå§¿æ€ï¼Œå°†ç¬¦å·èµ‹äºˆæ²»æ„ˆèŒè¶£æ„Ÿï¼Œæ„å»ºä¸“å±å¸çŒ«ç¬¦å·ä½“ç³»ã€‚'
            },
            {
                src: 'images/card8.jpg',
                name: 'å°é¾™æ ¼æ—èŒè¶£å›¾é‰´',
                category: 'èŒç³»è¡¨æƒ…ãƒ»æ²»æ„ˆå‘',
                description: 'åœ†æ¶¦èŒæ€çš„å°é¾™æ ¼æ—ï¼Œå€Ÿè›‹å£³ã€ç”œç­’ã€æ–¹å—å½¢å˜ç­‰è¶£å‘³åœºæ™¯ï¼Œæ¼”ç»ç–‘æƒ‘ã€å‚²å¨‡ã€æ¬¢è„±ç­‰æƒ…ç»ªï¼Œæ„å»ºæ²»æ„ˆç³»èŒé¾™äº’åŠ¨å›¾é‰´ã€‚'
            },
            {
                src: 'images/card9.jpg',
                name: 'çŒ«å’ªå®‡å®™å›¾é‰´',
                category: 'èŒç³»æ’ç”»ãƒ»å¸çŒ«æ²»æ„ˆ',
                description: 'å›´ç»•ã€Œä¸–ç•Œå› çŒ«è€Œç”ŸåŠ¨ã€çš„æ„è¶£ï¼Œæ±‡èšå¤šæ¯›è‰²ã€èŒæ€å„å¼‚çš„çŒ«å’ªï¼Œä»¥åœ†æ¶¦çº¿æ¡å‹¾å‹’å¸çŒ«æ²»æ„ˆåŠ›ï¼Œå®šæ ¼å–µæ˜Ÿäººè½¯èŒç¬é—´ã€‚'
            },
            {
                src: 'images/card10.jpg',
                name: 'ä¼é¹…å´½å´½èŒåŠ¨å›¾é‰´',
                category: 'èŒç³»è¡¨æƒ…ãƒ»æ²»æ„ˆäº’åŠ¨',
                description: 'åœ†æ»šæ»šä¼é¹…ä»¥çˆ±å¿ƒã€ç¬¦å·ç­‰å…ƒç´ ï¼Œæ¼”ç»å¿ƒåŠ¨ã€å›°å€¦ã€ç–‘æƒ‘ç­‰å¤šæ ·æƒ…ç»ªï¼Œæ„å»ºèŒè¶£äº’åŠ¨è¡¨æƒ…ä½“ç³»ã€‚'
            },
            {
                src: 'images/card11.jpg',
                name: 'è½¯èŒå¹½çµè¡¨æƒ…é›†',
                category: 'èŒç³»è¡¨æƒ…ãƒ»æ²»æ„ˆæ°›å›´',
                description: 'ä»¥åœ†æ¶¦çº¿æ¡å‹¾å‹’èŒæ€å¹½çµï¼Œæ­é…å·«å¸ˆå¸½ã€å—ç“œã€è´è¶ç»“ç­‰è¶£å‘³è£…é¥°ï¼Œæ¼”ç»å®³ç¾ã€æŠ±æ­‰ã€å¥½å¥‡ç­‰å¤šæ ·æƒ…ç»ªï¼Œæ„å»ºæ²»æ„ˆç³»å¹½çµäº’åŠ¨å›¾é‰´ã€‚'
            },
            {
                src: 'images/card12.jpg',
                name: 'èœ¡ç¬”å°æ–°è§’è‰²ç®€ç¬”ç”»åˆ†æ­¥å›¾é‰´',
                category: 'ç»˜ç”»æ•™ç¨‹ãƒ»åŠ¨æ¼«è§’è‰²',
                description: 'é€šè¿‡åˆ†æ­¥çº¿æ¡ï¼Œæ¼”ç¤ºèœ¡ç¬”å°æ–°ã€å¦®å¦®ç­‰è§’è‰²åŠé³„é±¼å±±ã€å°ç™½ç­‰å½¢è±¡çš„å¤´éƒ¨ç»˜åˆ¶ï¼Œæ‹†è§£èŒç³»ç®€ç¬”æŠ€æ³•ã€‚'
            },
        ];

        // è¡¨æƒ…ç´ ææ•°æ®
        // åŠ¨æ€ç”Ÿæˆ40ä¸ªfaceè¡¨æƒ…è·¯å¾„
        const generateFaceImages = () => {
            const faces = [];
            for (let i = 1; i <= 40; i++) {
                faces.push(`images/face${i}.png`);
            }
            return faces;
        };

        // åŠ¨æ€ç”Ÿæˆ14ä¸ªhairstyleè·¯å¾„
        const generateHairStyles = () => {
            const hairs = [];
            for (let i = 1; i <= 14; i++) {
                hairs.push(`images/hairstyle${i}.jpg`);
            }
            return hairs;
        };

        // åˆå¹¶åˆ°è¡¨æƒ…ç´ æå¯¹è±¡
        const è¡¨æƒ…ç´ æ = {
        hair: generateHairStyles(),
        eyes: generateFaceImages()
        };
        // åŠ¨æ€ç”Ÿæˆ30ä¸ªéšæœºè¡¨æƒ…å›¾ç‰‡è·¯å¾„
        const generateRandomEmojiImages = () => {
            const images = [];
            for (let i = 1; i <= 30; i++) {
                images.push(`images/guess${i}.jpg`); // ç¡®ä¿å›¾ç‰‡å®é™…å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
            }
            return images;
        };
        // åˆå§‹åŒ–éšæœºè¡¨æƒ…æ•°ç»„
        const randomEmojiImages = generateRandomEmojiImages();

        // åˆ®å¼€æ•ˆæœç»„ä»¶
        class ScratchToReveal {
            constructor(options) {
                this.options = {
                    container: null,
                    imageUrl: '',
                    width: 200,
                    height: 200,
                    revealThreshold: 0.7, // 70% åˆ®å¼€æ—¶è‡ªåŠ¨æ˜¾ç¤ºå…¨éƒ¨
                    gradientColors: ['#A97CF8', '#F38CB8', '#FDCC92'],
                    onRevealComplete: () => {},
                    ...options
                };
                
                this.init();
            }
            
            init() {
                // åˆ›å»ºå®¹å™¨
                this.container = document.createElement('div');
                this.container.className = 'relative w-full h-full';
                
                // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
                this.image = document.createElement('img');
                this.image.src = this.options.imageUrl;
                this.image.alt = 'åˆ®å¼€æŸ¥çœ‹';
                this.image.className = 'w-full h-full object-cover';
                
                // åˆ›å»ºCanvasç”¨äºåˆ®æ“¦æ•ˆæœ
                this.canvas = document.createElement('canvas');
                this.canvas.width = this.options.width;
                this.canvas.height = this.options.height;
                this.canvas.className = 'absolute top-0 left-0 w-full h-full cursor-pointer';
                
                // è·å–Canvasä¸Šä¸‹æ–‡
                this.ctx = this.canvas.getContext('2d');
                
                // æ·»åŠ åˆ°å®¹å™¨
                this.container.appendChild(this.image);
                this.container.appendChild(this.canvas);
                
                // æ¸…ç©ºçˆ¶å®¹å™¨å¹¶æ·»åŠ ç»„ä»¶
                this.options.container.innerHTML = '';
                this.options.container.appendChild(this.container);
                
                // åˆå§‹åŒ–æ¶‚å±‚
                this.setupScratchLayer();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // åˆå§‹åŒ–ç»Ÿè®¡
                this.totalPixels = this.canvas.width * this.canvas.height;
                this.revealedPixels = 0;
            }
            
            setupScratchLayer() {
                // åˆ›å»ºæ¸å˜èƒŒæ™¯
                const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
                this.options.gradientColors.forEach((color, index) => {
                    gradient.addColorStop(index / (this.options.gradientColors.length - 1), color);
                });
                
                // å¡«å……æ¸å˜
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // æ·»åŠ å™ªç‚¹æ•ˆæœ
                this.addNoise();
            }
            
            addNoise() {
                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // æ·»åŠ éšæœºå™ªç‚¹
                    const noise = Math.random() * 50 - 25; // -25 to 25
                    data[i] += noise;     // R
                    data[i + 1] += noise; // G
                    data[i + 2] += noise; // B
                }
                
                this.ctx.putImageData(imageData, 0, 0);
            }
            
            bindEvents() {
                // é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
                let isDrawing = false;
                
                const handleStart = (e) => {
                    isDrawing = true;
                    this.handleScratch(e);
                };
                
                const handleMove = (e) => {
                    if (isDrawing) {
                        this.handleScratch(e);
                    }
                };
                
                const handleEnd = () => {
                    isDrawing = false;
                    
                    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ­ç¤ºé˜ˆå€¼
                    if (this.revealedPixels / this.totalPixels >= this.options.revealThreshold) {
                        this.revealAll();
                    }
                };
                
                // é¼ æ ‡äº‹ä»¶
                this.canvas.addEventListener('mousedown', handleStart);
                this.canvas.addEventListener('mousemove', handleMove);
                window.addEventListener('mouseup', handleEnd);
                
                // è§¦æ‘¸äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleStart(e.touches[0]);
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    handleMove(e.touches[0]);
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    handleEnd();
                });
            }
            
            handleScratch(event) {
                // è·å–ç›¸å¯¹äºCanvasçš„åæ ‡
                const rect = this.canvas.getBoundingClientRect();
                const x = (event.clientX || event.pageX) - rect.left;
                const y = (event.clientY || event.pageY) - rect.top;
                
                // æ“¦é™¤åœ†å½¢åŒºåŸŸ
                const radius = 20;
                this.ctx.globalCompositeOperation = 'destination-out';
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius, 0, Math.PI * 2);
                this.ctx.fill();
                
                // è®¡ç®—å·²æ­ç¤ºåŒºåŸŸ
                this.calculateRevealedArea();
            }
            
            calculateRevealedArea() {
                // è·å–å›¾åƒæ•°æ®
                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
                const data = imageData.data;
                let revealed = 0;
                
                // è®¡ç®—é€æ˜åƒç´ æ•°é‡
                for (let i = 3; i < data.length; i += 4) {
                    if (data[i] === 0) {
                        revealed++;
                    }
                }
                
                // æ›´æ–°å·²æ­ç¤ºåƒç´ æ•°
                this.revealedPixels = revealed;
                
                // å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œè§¦å‘å®Œæˆå›è°ƒ
                if (this.revealedPixels / this.totalPixels >= 1) {
                    this.options.onRevealComplete();
                }
            }
            
            revealAll() {
                // å®Œå…¨æ˜¾ç¤ºä¸‹æ–¹å›¾ç‰‡
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.options.onRevealComplete();
            }
        }

        // è·å–DOMå…ƒç´ 
        const container = document.getElementById('emoji-container');
        const marquee = document.getElementById('marquee');
        const speedDownBtn = document.getElementById('speed-down');
        const speedUpBtn = document.getElementById('speed-up');
        const reverseBtn = document.getElementById('reverse');
        const generateRandomEmojiBtn = document.getElementById('generate-random-emoji');
        const randomEmojiDisplay = document.getElementById('random-emoji-display');
        const openEmojiMakerBtn = document.getElementById('open-emoji-maker');
        const closeEmojiMakerBtn = document.getElementById('close-emoji-maker');
        const emojiMakerModal = document.getElementById('emoji-maker-modal');
        const emojiItemsContainer = document.getElementById('emoji-items-container');
        const prevEmojiBtn = document.getElementById('prev-emoji');
        const nextEmojiBtn = document.getElementById('next-emoji');
        const emojiName = document.getElementById('emoji-name');
        const emojiCategory = document.getElementById('emoji-category');
        const emojiDescription = document.getElementById('emoji-description');
        const loadingPlaceholder = document.getElementById('loading-placeholder');
        
        // è¡¨æƒ…åˆ¶ä½œå™¨å…ƒç´ 
        const eyesImg = document.getElementById('eyes-img');
        const hairImg = document.getElementById('hair-img');
        const successMessage = document.getElementById('success-message');
        let scale = 1.0;
        let offsetX = 0;
        let offsetY = 0;
        
        // åˆå§‹é€Ÿåº¦å’Œæ–¹å‘
        let speed = 20; // åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
        let isReverse = false;
        let activeEmojiIndex = 0;
        let autoplayInterval;
        
        // åˆå§‹åŒ–BlurFadeåŠ¨ç”»
        function initBlurFade() {
            const blurFadeElements = document.querySelectorAll('.blur-fade');
            
            // åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œæ£€æµ‹å…ƒç´ æ˜¯å¦è¿›å…¥è§†å£
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // è·å–å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
                        const delay = parseFloat(entry.target.getAttribute('data-delay')) || 0;
                        
                        // è®¾ç½®å»¶è¿Ÿæ˜¾ç¤º
                        setTimeout(() => {
                            entry.target.classList.add('visible');
                        }, delay * 1000);
                        
                        // åªè§‚å¯Ÿä¸€æ¬¡
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            // è§‚å¯Ÿæ‰€æœ‰å¸¦blur-fadeç±»çš„å…ƒç´ 
            blurFadeElements.forEach(element => {
                observer.observe(element);
            });
        }
        
        // åˆå§‹åŒ–BlurFadeåŠ¨ç”»
        function initBlurFade() {
            const blurFadeElements = document.querySelectorAll('.blur-fade');
            
            // åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œæ£€æµ‹å…ƒç´ æ˜¯å¦è¿›å…¥è§†å£
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // è·å–å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
                        const delay = parseFloat(entry.target.getAttribute('data-delay')) || 0;
                        
                        // è®¾ç½®å»¶è¿Ÿæ˜¾ç¤º
                        setTimeout(() => {
                            entry.target.classList.add('visible');
                        }, delay * 1000);
                        
                        // åªè§‚å¯Ÿä¸€æ¬¡
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            // è§‚å¯Ÿæ‰€æœ‰å¸¦blur-fadeç±»çš„å…ƒç´ 
            blurFadeElements.forEach(element => {
                observer.observe(element);
            });
        }
        
        // åˆå§‹åŒ–è·‘é©¬ç¯
        function initMarquee() {
            // ç”Ÿæˆå¤šè½®è¡¨æƒ…å¡ç‰‡ï¼ˆå®ç°æ— ç¼æ»šåŠ¨ï¼‰
            for (let round = 0; round < 4; round++) {
                emojis.forEach(emoji => {
                    // åˆ›å»ºè¡¨æƒ…å¡ç‰‡å…ƒç´ 
                    const card = createEmojiCard(emoji);
                    
                    // æ·»åŠ åˆ°å®¹å™¨
                    container.appendChild(card);
                });
            }
            
            // æ›´æ–°è·‘é©¬ç¯åŠ¨ç”»
            updateMarquee();
        }
        
        // åˆ›å»ºè¡¨æƒ…å¡ç‰‡
        function createEmojiCard(emoji) {
            const card = document.createElement('div');
            card.className = `emoji-card ${emoji.bgClass} rounded-lg p-4 shadow-md w-32 text-center`;
            
            // è®¾ç½®å¡ç‰‡å†…å®¹
            card.innerHTML = `
                <img src="${emoji.image}" alt="${emoji.alt}" class="w-20 h-20 mx-auto mb-2 rounded-full object-cover">
                <p class="text-sm font-medium">${emoji.title}</p>
            `;
            
            return card;
        }
        
        // æ›´æ–°è·‘é©¬ç¯åŠ¨ç”»
        function updateMarquee() {
            marquee.style.animation = `marquee ${speed}s linear ${isReverse ? 'reverse' : 'normal'} infinite`;
        }
        
        // åˆå§‹åŒ–éšæœºè¡¨æƒ…ç”Ÿæˆå™¨ï¼ˆå¸¦åˆ®å¼€æ•ˆæœï¼‰
        function initRandomEmojiGenerator() {
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            generateRandomEmojiBtn.addEventListener('click', () => {
                // éšæœºé€‰æ‹©ä¸€ä¸ªå›¾ç‰‡
                const selectedImage = randomEmojiImages[Math.floor(Math.random() * randomEmojiImages.length)];

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                randomEmojiDisplay.innerHTML = '';
                const loadingContainer = document.createElement('div');
                loadingContainer.className = 'w-full h-full purple-gradient-bg flex items-center justify-center';
                loadingContainer.innerHTML = `
                    <div class="text-center">
                        <i class="fa fa-magic text-white text-5xl mb-2 animate-spin"></i>
                        <p class="text-white font-medium">ç”Ÿæˆä¸­...</p>
                    </div>
                `;
                randomEmojiDisplay.appendChild(loadingContainer);
                
                // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
                setTimeout(() => {
                    // ç§»é™¤åŠ è½½çŠ¶æ€
                    randomEmojiDisplay.innerHTML = '';
                    
                    // æ·»åŠ å®¹å™¨
                    const animationContainer = document.createElement('div');
                    animationContainer.className = 'mx-auto w-80 h-80 rounded-lg shadow-lg overflow-hidden';
                    randomEmojiDisplay.appendChild(animationContainer);
                    
                    // åˆ›å»ºåˆ®å¼€æ•ˆæœç»„ä»¶
                    new ScratchToReveal({
                        container: animationContainer,
                        imageUrl: selectedImage,
                        width: 320,
                        height: 320,
                        gradientColors: ['#A97CF8', '#F38CB8', '#FDCC92'],
                        onRevealComplete: () => {
                            // åˆ®å¼€å®Œæˆåçš„å›è°ƒ - æ·»åŠ æ”¾å¤§æ‘‡æ‘†æ•ˆæœ
                            const revealedImage = animationContainer.querySelector('img');
                            if (revealedImage) {
                                // ç„¶åæ·»åŠ å•æ¬¡æ‘‡æ‘†åŠ¨ç”»
                                setTimeout(() => {
                                    revealedImage.classList.add('animate-swing-once');
                                }, 100);
                            }
                        }
                    });
                }, 1500);
            });
        }
        // æ›´æ–°çœ¼ç›æ ·å¼
        const updateEyesStyle = () => {
            eyesImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
        };
        
        // åŠ¨æ€ç”Ÿæˆå‘å‹é€‰é¡¹ï¼ˆç¡®ä¿ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤é€‰ä¸­ï¼‰
        function generateHairOptions() {
            const hairOptionsContainer = document.getElementById('hair-options');
            hairOptionsContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            
            è¡¨æƒ…ç´ æ.hair.forEach((hair, index) => {
                const hairOption = document.createElement('div');
                // ç¬¬ä¸€ä¸ªé€‰é¡¹é»˜è®¤æ·»åŠ selectedç±»
                hairOption.className = `emoji-part ${index === 0 ? 'selected' : ''}`;
                hairOption.dataset.type = 'hair';
                hairOption.dataset.index = index;
                
                hairOption.innerHTML = `<img src="${hair}" alt="å‘å‹${index + 1}" class="w-10 h-10 rounded-full object-cover" />`;
                hairOptionsContainer.appendChild(hairOption);
            });
        }

        // åŠ¨æ€ç”Ÿæˆçœ¼ç›é€‰é¡¹ï¼ˆç¡®ä¿ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤é€‰ä¸­ï¼‰
        function generateEyesOptions() {
            const eyesOptionsContainer = document.getElementById('eyes-options');
            eyesOptionsContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            
            è¡¨æƒ…ç´ æ.eyes.forEach((eye, index) => {
                const eyeOption = document.createElement('div');
                // ç¬¬ä¸€ä¸ªé€‰é¡¹é»˜è®¤æ·»åŠ selectedç±»
                eyeOption.className = `emoji-part ${index === 0 ? 'selected' : ''}`;
                eyeOption.dataset.type = 'eyes';
                eyeOption.dataset.index = index;
                
                eyeOption.innerHTML = `<img src="${eye}" alt="çœ¼ç›${index + 1}" class="w-10 h-10 rounded-full object-cover" />`;
                eyesOptionsContainer.appendChild(eyeOption);
            });
        }

        // åˆå§‹åŒ–è¡¨æƒ…åˆ¶ä½œå™¨
        function initEmojiMaker() {
            // æ‰“å¼€å¼¹çª—
            openEmojiMakerBtn.addEventListener('click', () => {
                emojiMakerModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            });
            
            // å…³é—­å¼¹çª—
            closeEmojiMakerBtn.addEventListener('click', () => {
                emojiMakerModal.classList.remove('active');
                document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            });
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—
            emojiMakerModal.addEventListener('click', (e) => {
                if (e.target === emojiMakerModal) {
                    emojiMakerModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
            
             // åŠ¨æ€ç”Ÿæˆæ‰€æœ‰é€‰é¡¹
            generateHairOptions();
            generateEyesOptions();
            
            // ä¸ºåŠ¨æ€ç”Ÿæˆçš„å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬
            document.addEventListener('click', function(e) {
                const emojiPart = e.target.closest('.emoji-part');
                if (emojiPart && ['hair', 'eyes'].includes(emojiPart.dataset.type)) {
                    const type = emojiPart.dataset.type;
                    const index = emojiPart.dataset.index;
                    const imgElement = document.getElementById(`${type}-img`);
                    
                    if (imgElement) {
                        // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
                        imgElement.style.opacity = '0.5';
                        setTimeout(() => {
                            imgElement.src = è¡¨æƒ…ç´ æ[type][index];
                            imgElement.style.opacity = '1';
                        }, 150);
                    }
                    
                    // æ›´æ–°é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll(`[data-type="${type}"]`).forEach(p => p.classList.remove('selected'));
                    emojiPart.classList.add('selected');
                }
            });
    
            // ç¼©æ”¾æ§åˆ¶
            document.getElementById('zoom-in-btn').addEventListener('click', () => {
                scale += 0.05;
                updateEyesStyle();
            });
            
            document.getElementById('zoom-out-btn').addEventListener('click', () => {
                scale = Math.max(0.1, scale - 0.05);
                updateEyesStyle();
            });
            
            // æ–¹å‘æ§åˆ¶
            const step = 3;
            document.getElementById('move-up-btn').addEventListener('click', () => {
                offsetY -= step;
                updateEyesStyle();
            });
            
            document.getElementById('move-down-btn').addEventListener('click', () => {
                offsetY += step;
                updateEyesStyle();
            });
            
            document.getElementById('move-left-btn').addEventListener('click', () => {
                offsetX -= step;
                updateEyesStyle();
            });
            
            document.getElementById('move-right-btn').addEventListener('click', () => {
                offsetX += step;
                updateEyesStyle();
            });
            
            // é‡ç½®æŒ‰é’®é€»è¾‘ï¼ˆä¿®æ”¹é‡ç½®æ—¶æ¢å¤é»˜è®¤é€‰é¡¹ï¼‰
            document.getElementById('reset-btn').addEventListener('click', () => {
                // é‡ç½®ä½ç½®å’Œç¼©æ”¾
                scale = 1.0;
                offsetX = 0;
                offsetY = 0;
                updateEyesStyle();

                // é‡ç½®ä¸ºç¬¬ä¸€ä¸ªå‘å‹å’Œçœ¼ç›
                if (è¡¨æƒ…ç´ æ.hair.length > 0) {
                    hairImg.src = è¡¨æƒ…ç´ æ.hair[0];
                    // æ›´æ–°å‘å‹é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('[data-type="hair"]').forEach(p => p.classList.remove('selected'));
                    document.querySelector('[data-type="hair"][data-index="0"]')?.classList.add('selected');
                }
                if (è¡¨æƒ…ç´ æ.eyes.length > 0) {
                    eyesImg.src = è¡¨æƒ…ç´ æ.eyes[0];
                    // æ›´æ–°çœ¼ç›é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('[data-type="eyes"]').forEach(p => p.classList.remove('selected'));
                    document.querySelector('[data-type="eyes"][data-index="0"]')?.classList.add('selected');
                }
            });
            
            // å®ŒæˆæŒ‰é’®äº‹ä»¶
            document.getElementById('complete-btn').addEventListener('click', () => {
                // æ£€æŸ¥confettiæ˜¯å¦å¯ç”¨
                if (typeof confetti === 'function') {
                    fireConfetti();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    successMessage.classList.remove('hidden');
                    setTimeout(() => {
                        successMessage.classList.add('hidden');
                    }, 2500);
                } else {
                    alert('ç²’å­æ•ˆæœåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼');
                }
            });
        }
        
        // ç²’å­æ•ˆæœ
        function fireConfetti() {
            // è·å–canvaså…ƒç´ 
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            
            // ç¡®ä¿canvaså¤§å°ä¸çª—å£åŒ¹é…
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // ä½¿ç”¨confettiåº“
            confetti({
                particleCount: 300,
                spread: 100,
                origin: { y: 0.6 }
            });
            
            // æ·»åŠ æ›´å¤šæ•ˆæœ
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
            }, 250);
            
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });
            }, 500);
        }

        // åˆå§‹åŒ–è¡¨æƒ…åº“å±•ç¤º
        function initEmojiGallery() {
            // æ¸²æŸ“è¡¨æƒ…é¡¹
            renderEmojiGallery();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            prevEmojiBtn.addEventListener('click', showPrevEmoji);
            nextEmojiBtn.addEventListener('click', showNextEmoji);
            
            // å¯åŠ¨è‡ªåŠ¨æ’­æ”¾
            startAutoplay();
            
            // é¼ æ ‡æ‚¬åœæ—¶æš‚åœè‡ªåŠ¨æ’­æ”¾
            const emojiGallerySection = document.querySelector('.emoji-gallery');
            emojiGallerySection.addEventListener('mouseenter', stopAutoplay);
            emojiGallerySection.addEventListener('mouseleave', startAutoplay);
        }
        
        // æ¸²æŸ“è¡¨æƒ…åº“
        function renderEmojiGallery() {
            // æ¸…ç©ºå®¹å™¨
            emojiItemsContainer.innerHTML = '';
            
            // åˆ›å»ºè¡¨æƒ…é¡¹
            emojiGallery.forEach((emoji, index) => {
                const emojiItem = document.createElement('div');
                emojiItem.className = `emoji-item rounded-3xl overflow-hidden`;
                
                // éšæœºæ—‹è½¬è§’åº¦ï¼ˆé™¤äº†å½“å‰æ´»åŠ¨é¡¹ï¼‰
                const rotateY = index !== activeEmojiIndex ? (Math.random() * 20 - 10) : 0;
                emojiItem.style.setProperty('--rotate-y', `${rotateY}deg`);
                
                // è®¾ç½®å†…å®¹
                emojiItem.innerHTML = `<img src="${emoji.src}" alt="${emoji.name}" class="w-full h-full object-contain" />`;
                
                // æ·»åŠ åˆ°å®¹å™¨
                emojiItemsContainer.appendChild(emojiItem);
                
                // è®¾ç½®åˆå§‹çŠ¶æ€
                if (index === activeEmojiIndex) {
                    emojiItem.classList.add('active');
                } else {
                    emojiItem.classList.add('inactive');
                }
            });
            
            // æ›´æ–°ä¿¡æ¯
            updateEmojiInfo();
        }
        
        // æ›´æ–°è¡¨æƒ…ä¿¡æ¯
        function updateEmojiInfo() {
            const currentEmoji = emojiGallery[activeEmojiIndex];
            
            // æ›´æ–°æ–‡æœ¬å†…å®¹
            emojiName.textContent = currentEmoji.name;
            emojiCategory.textContent = currentEmoji.category;
            
            // æ¸…ç©ºæè¿°å¹¶æ·»åŠ é€å­—åŠ¨ç”»
            emojiDescription.textContent = '';
            const words = currentEmoji.description.split(' ');
            
            words.forEach((word, index) => {
                const span = document.createElement('span');
                span.className = 'word-animation';
                span.textContent = word + ' ';
                emojiDescription.appendChild(span);
                
                // å»¶è¿Ÿæ˜¾ç¤ºæ¯ä¸ªå•è¯ï¼Œåˆ›å»ºé€å­—åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    span.style.opacity = '1';
                    span.style.filter = 'blur(0)';
                    span.style.transform = 'translateY(0)';
                }, 30 * index);
            });
        }
        
        // æ˜¾ç¤ºä¸Šä¸€ä¸ªè¡¨æƒ…
        function showPrevEmoji() {
            // æ›´æ–°ç´¢å¼•
            activeEmojiIndex = (activeEmojiIndex - 1 + emojiGallery.length) % emojiGallery.length;
            
            // æ›´æ–°æ˜¾ç¤º
            updateEmojiItems();
        }
        
        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¡¨æƒ…
        function showNextEmoji() {
            // æ›´æ–°ç´¢å¼•
            activeEmojiIndex = (activeEmojiIndex + 1) % emojiGallery.length;
            
            // æ›´æ–°æ˜¾ç¤º
            updateEmojiItems();
        }
        
        // æ›´æ–°è¡¨æƒ…é¡¹çŠ¶æ€
        function updateEmojiItems() {
            const emojiItems = document.querySelectorAll('.emoji-item');
            
            emojiItems.forEach((item, index) => {
                // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
                item.classList.remove('active', 'inactive');
                
                // éšæœºæ—‹è½¬è§’åº¦ï¼ˆé™¤äº†å½“å‰æ´»åŠ¨é¡¹ï¼‰
                const rotateY = index !== activeEmojiIndex ? (Math.random() * 20 - 10) : 0;
                item.style.setProperty('--rotate-y', `${rotateY}deg`);
                
                // è®¾ç½®æ–°çŠ¶æ€
                if (index === activeEmojiIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.add('inactive');
                }
            });
            
            // æ›´æ–°ä¿¡æ¯
            updateEmojiInfo();
        }
        
        // å¯åŠ¨è‡ªåŠ¨æ’­æ”¾
        function startAutoplay() {
            if (!autoplayInterval) {
                autoplayInterval = setInterval(showNextEmoji, 5000);
            }
        }
        
        // åœæ­¢è‡ªåŠ¨æ’­æ”¾
        function stopAutoplay() {
            if (autoplayInterval) {
                clearInterval(autoplayInterval);
                autoplayInterval = null;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–BlurFadeåŠ¨ç”»
            initBlurFade();
            
            initMarquee();
            
            // åˆå§‹åŒ–éšæœºè¡¨æƒ…ç”Ÿæˆå™¨
            initRandomEmojiGenerator();
            
            // åˆå§‹åŒ–è¡¨æƒ…åˆ¶ä½œå™¨
            initEmojiMaker();
            
            // åˆå§‹åŒ–è¡¨æƒ…åº“å±•ç¤º
            initEmojiGallery();
            
            // è·‘é©¬ç¯æ§åˆ¶æŒ‰é’®äº‹ä»¶
            speedDownBtn.addEventListener('click', () => {
                if (speed < 60) { // æœ€å¤§å»¶è¿Ÿ60ç§’
                    speed += 5;
                    updateMarquee();
                }
            });
            
            speedUpBtn.addEventListener('click', () => {
                if (speed > 5) { // æœ€å°å»¶è¿Ÿ5ç§’
                    speed -= 5;
                    updateMarquee();
                }
            });
            
            reverseBtn.addEventListener('click', () => {
                isReverse = !isReverse;
                updateMarquee();
            });
        });
    </script>
</body>
</html>
    